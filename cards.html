<!-- Save as: cards.html -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cards â€” isolated</title>
<style>
/* --- Original CSS, preserved. This page is self-contained. --- */
/* Slightly trimmed comments, exact variables kept. */
:root{--card-w:180px;--card-h:260px;--radius:18px;--card-w-sm:calc(var(--card-w)*0.7);--card-h-sm:calc(var(--card-h)*0.7);--scale-sm:.7;--arrow-gap-left:calc(var(--card-w)*1.5);--arrow-gap-right:calc(var(--card-w)*1.5);--hl:#7ec8ff;--phase1-dur:250ms;--phase2-dur:360ms;--center-offset:0px;--result-dur:220ms;--scanline-dur:3s;--main-opacity:1;--prev-opacity:.85;--next-opacity:.85;--main-offset-px:0px;--prev-offset-factor:.72;--next-offset-factor:.72;--main-tilt-x:0deg;--main-tilt-y:0deg;--main-tilt-z:0deg;--prev-tilt-x:0deg;--prev-tilt-y:0deg;--prev-tilt-z:-60deg;--next-tilt-x:0deg;--next-tilt-y:0deg;--next-tilt-z:60deg;--prev-scale:.93;--next-scale:.93;--z-main:10;--z-prev:2;--z-next:2;--mode-btn-size:48px;--mode-gap:20px;--icon-size:24px;--mode-fill:#fb7575;--mode-border:#fff}
*{box-sizing:border-box}
html,body{height:auto;margin:0;padding:0;background:transparent}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;color:#fff;display:grid;place-items:center;padding:6px}
.stage{position:relative;display:grid;place-items:center;min-height:var(--card-h);cursor:grab;transform:translateY(var(--center-offset));perspective:900px;transform-style:preserve-3d}
/* minimal background so the page itself is cropped to the stage */
.wrapper{display:inline-grid; padding:0; margin:0; background:transparent; overflow:visible;}

/* card styles */
.card{position:absolute;width:var(--card-w);height:var(--card-h);border-radius:var(--radius);overflow:hidden;background:#111;box-shadow:0 12px 30px rgba(0,0,0,.45);transition:transform .35s ease, filter .35s ease, opacity .35s ease, outline-color .18s ease, outline-width .18s ease}
.card::before{content:"";position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--hl),transparent);animation:scanline var(--scanline-dur) linear infinite;pointer-events:none;box-shadow:0 0 10px rgba(126,200,255,.5)}
.card::after{content:"";position:absolute;inset:auto 0 0 0;height:40%;background:linear-gradient(to top,rgba(0,0,0,.7),rgba(0,0,0,0));pointer-events:none;transform:translateY(20px)}
.bg{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;filter:saturate(1.05) contrast(1.02);pointer-events:none;user-select:none}
.avatar{position:absolute;left:50%;bottom:0;transform:translateX(-50%);width:72%;height:auto;object-fit:contain;user-select:none;-webkit-user-drag:none;pointer-events:none}
.text{position:absolute;left:16px;bottom:16px;display:flex;flex-direction:column;gap:4px;z-index:2}
.name{font-weight:700;font-size:1.15rem;letter-spacing:.2px;user-select:none}
.handle{opacity:.7;font-size:.95rem}

/* main/prev/next */
.card.main{z-index:var(--z-main);outline:0 solid var(--hl);opacity:var(--main-opacity);transform:translateX(var(--main-offset-px)) rotateX(var(--main-tilt-x)) rotateY(var(--main-tilt-y)) rotateZ(var(--main-tilt-z))}
.card.prev,.card.next{width:var(--card-w-sm);height:var(--card-h-sm);filter:blur(2px);pointer-events:none}
.card.prev{opacity:var(--prev-opacity);transform:translateX(calc(-1 * var(--card-w) * var(--prev-offset-factor))) rotateX(var(--prev-tilt-x)) rotateY(var(--prev-tilt-y)) rotateZ(var(--prev-tilt-z));z-index:var(--z-prev)}
.card.next{opacity:var(--next-opacity);transform:translateX(calc(var(--card-w) * var(--next-offset-factor))) rotateX(var(--next-tilt-x)) rotateY(var(--next-tilt-y)) rotateZ(var(--next-tilt-z));z-index:var(--z-next)}

.card.preload{pointer-events:none;opacity:.5;filter:blur(2px);z-index:1}

/* arrows */
.arrow{position:absolute;top:50%;transform:translateY(-50%);background:rgba(255,255,255,.12);color:#fff;border:none;border-radius:999px;width:clamp(32px, calc(var(--card-w)*0.14), 56px);height:clamp(32px, calc(var(--card-w)*0.14), 56px);display:grid;place-items:center;backdrop-filter:blur(6px);cursor:pointer;z-index:4;font-size:clamp(20px, calc(var(--card-w)*0.08), 32px);user-select:none;-webkit-tap-highlight-color:transparent}
.arrow.left{left:calc(50% - var(--arrow-gap-left))}
.arrow.right{left:calc(50% + var(--arrow-gap-right))}
.arrow:hover{background:rgba(255,255,255,.18)}

/* tracker bubbles */
.ui-stack{position:relative;display:flex;flex-direction:column;align-items:center;gap:20px;margin-top:calc(var(--card-h)/2 + 20px)}
.tracker{display:flex;gap:10px;justify-content:center}
.bubble-slot{position:relative;width:var(--bubble-size,13px);height:var(--bubble-size,13px);display:grid;place-items:center}
.bubble{background:rgba(255,255,255,.35);height:var(--bubble-size,13px);width:var(--bubble-size,13px);border-radius:50%;opacity:var(--bubble-opacity, .9);display:grid;place-items:center;transition:opacity var(--phase2-dur) ease, transform var(--phase2-dur) cubic-bezier(.34,1.56,.64,1)}
.bubble-glow{position:absolute;inset:0;background:#fff;border-radius:50%;transform:scale(1.15);opacity:1;transition:opacity var(--glow-dur, 220ms) ease, transform var(--glow-dur, 220ms) cubic-bezier(.34,1.56,.64,1);z-index:2;pointer-events:none;box-shadow:0 0 10px rgba(255,255,255,.85),0 0 18px rgba(126,200,255,.5)}

/* animations and responsive */
@keyframes growBounce{0%{transform:translateX(0) scale(0.93)}70%{transform:translateX(0) scale(1.06)}100%{transform:translateX(0) scale(1)}}
@keyframes settleFade{0%{transform:scale(1.02)}100%{transform:scale(1)}}
@keyframes scanline{0%{transform:translateY(0)}100%{transform:translateY(var(--card-h))}}
.card.main.settle{animation:settleFade var(--result-dur) ease}
.stage.move-left .card.next{animation:growBounce var(--phase2-dur) cubic-bezier(.17,.67,.36,1.31)}
.stage.move-right .card.prev{animation:growBounce var(--phase2-dur) cubic-bezier(.17,.67,.36,1.31)}

@media (max-width:768px){:root{--card-w:68vw;--card-h:calc(68vw*1.35);--card-w-sm:calc(var(--card-w)*0.7);--card-h-sm:calc(var(--card-h)*0.7)}}
@media (max-width:420px){:root{--card-w:74vw;--card-h:calc(74vw*1.35);--card-w-sm:calc(var(--card-w)*0.7);--card-h-sm:calc(var(--card-h)*0.7)}}

/* utility: hide overflow so page crops perfectly */
html,body{overflow:hidden}
</style>
</head>
<body>
  <div class="wrapper">
    <div class="stage" id="stage">
      <div class="card prev" id="card-prev">
        <img class="bg" alt="background" draggable="false" />
        <img class="avatar" alt="avatar" draggable="false" />
        <div class="text">
          <div class="name"></div>
          <div class="handle"></div>
        </div>
      </div>

      <div class="card main" id="card-main">
        <img class="bg" alt="background" draggable="false" />
        <img class="avatar" alt="avatar" draggable="false" />
        <div class="text">
          <div class="name"></div>
          <div class="handle"></div>
        </div>
      </div>

      <div class="card next" id="card-next">
        <img class="bg" alt="background" draggable="false" />
        <img class="avatar" alt="avatar" draggable="false" />
        <div class="text">
          <div class="name"></div>
          <div class="handle"></div>
        </div>
      </div>

      <div class="card preload" id="card-preload">
        <img class="bg" alt="background" draggable="false" />
        <img class="avatar" alt="avatar" draggable="false" />
        <div class="text">
          <div class="name"></div>
          <div class="handle"></div>
        </div>
      </div>

      <button class="arrow left" id="arrow-left" aria-label="Previous">&#x2039;</button>
      <button class="arrow right" id="arrow-right" aria-label="Next">&#x203A;</button>

      <div class="ui-stack" id="ui-stack">
        <div class="tracker" id="tracker"></div>
      </div>
    </div>
  </div>

<script>
/* --- Essential JS for the carousel (copied and trimmed to the relevant parts) --- */
/* The code keeps the original behaviour and API (characters array etc). Minimal audio and assets handling omitted. */

let characters = [
  // placeholder demo entries so standalone file shows something:
  { id:'a1', name:'Alice', handle:'@alice', bg:'', avatar:'', },
  { id:'b2', name:'Bob', handle:'@bob', bg:'', avatar:'', },
  { id:'c3', name:'Celia', handle:'@celia', bg:'', avatar:'', }
];
let defaultBg = '';
let currentIndex = 0;
let isCardAnimating = false;
let isBubbleAnimating = false;
let bubbleState = { glowSlot:'b' };
let settings = { switchAnimation:true, highlightColor:'#7ec8ff', animationSpeedPercent:100 };

function apply(cardEl, character){
  const bg=(character.bg&&character.bg.trim())?character.bg:defaultBg;
  const bgEl = cardEl.querySelector('.bg');
  if(bgEl){ bgEl.src = bg || ''; }
  const av = cardEl.querySelector('.avatar');
  if(av){ av.src = (character.avatar && character.avatar.trim()) ? character.avatar : './assets/phavatar.png'; }
  cardEl.querySelector('.name').textContent = character.name || '';
  cardEl.querySelector('.handle').textContent = character.handle || '';
}

function render(){
  const main=document.getElementById('card-main');
  const prev=document.getElementById('card-prev');
  const next=document.getElementById('card-next');
  const preload=document.getElementById('card-preload');
  const n=characters.length;
  const i=currentIndex;
  const p=(i-1+n)%n;
  const q=(i+1)%n;
  const r=(i+2)%n;
  apply(main,characters[i]);
  apply(prev,characters[p]);
  apply(next,characters[q]);
  if(preload){apply(preload,characters[r])}
  if(!isBubbleAnimating){ renderBubbles(); }
  const s=document.querySelector('.stage');
  s.classList.remove('preload-left','preload-right');
  s.classList.add('preload-right');
}

/* bubble rendering kept minimal */
function renderBubbles(){
  const el=document.getElementById('tracker');
  if(!el) return;
  el.innerHTML='';
  const slots=['a','b','c'];
  slots.forEach(slot=>{
    const slotEl=document.createElement('div');
    slotEl.className=`bubble-slot slot-${slot}`;
    const bubble=document.createElement('div');
    bubble.className='bubble';
    bubble.setAttribute('data-slot',slot);
    slotEl.appendChild(bubble);
    el.appendChild(slotEl);
  });
  const n=characters.length; const i=currentIndex;
  bubbleState.glowSlot = i===0 ? 'a' : (i===n-1 ? 'c' : 'b');
  ensureGlow();
}
function ensureGlow(){
  const el=document.getElementById('tracker');
  const glowExisting=el.querySelector('.bubble-glow');
  const targetSlot=el.querySelector(`.bubble-slot.slot-${bubbleState.glowSlot} .bubble`);
  if(!targetSlot) return;
  if(!glowExisting){
    const glow=document.createElement('div');
    glow.className='bubble-glow';
    targetSlot.appendChild(glow);
  }else{
    glowExisting.parentNode&&glowExisting.parentNode.removeChild(glowExisting);
    targetSlot.appendChild(glowExisting);
  }
}

/* simple navigation */
function navigate(direction){
  if(isCardAnimating||isBubbleAnimating) return;
  const dir = direction === 'left' ? 1 : -1;
  if(!settings.switchAnimation){
    currentIndex = (currentIndex + dir + characters.length) % characters.length;
    render(); return;
  }
  const s=document.querySelector('.stage');
  isCardAnimating=true;
  s.classList.remove('anim-left','anim-right','preload-left','preload-right','size-left','size-right','move-left','move-right','phase1','phase2');
  s.classList.add(direction==='left'?'preload-right':'preload-left');
  s.classList.add('phase1');
  s.offsetHeight;
  s.classList.add(direction==='left'?'size-left':'size-right');
  const scale=100/settings.animationSpeedPercent; const gapMs=Math.round(140*scale); const moveMs=Math.round(360*scale);
  setTimeout(()=>{
    s.classList.remove('phase1');
    s.classList.add('phase2');
    s.classList.add(direction==='left'?'move-left':'move-right');
    setTimeout(()=>{
      currentIndex = (currentIndex + dir + characters.length) % characters.length;
      s.classList.remove('phase2','size-left','size-right','move-left','move-right','preload-left','preload-right');
      s.classList.add('finalize');
      render();
      const main=document.getElementById('card-main');
      if(main){main.classList.add('settle');setTimeout(()=>{main.classList.remove('settle')},Math.round(220*(100/settings.animationSpeedPercent)))}
      s.offsetHeight;
      s.classList.remove('finalize');
      isCardAnimating=false;
    },moveMs);
  },gapMs);
}

/* arrows */
document.addEventListener('DOMContentLoaded',()=>{
  render();
  const left=document.getElementById('arrow-left'), right=document.getElementById('arrow-right');
  if(left) left.addEventListener('click',()=>navigate('right'));
  if(right) right.addEventListener('click',()=>navigate('left'));
  // simple click-to-open simulation
  const main=document.getElementById('card-main');
  if(main){
    main.addEventListener('click',(e)=>{
      // no sheet in isolated file; just log
      const c = characters[currentIndex];
      console.log('open sheet for', c && c.id);
    });
  }
});

/* expose a simple API so hub could call mountCardsFromData if needed */
window.cardModule = {
  setCharacters(arr){ if(Array.isArray(arr)) { characters = arr; currentIndex = 0; render(); } },
  go(index){ if(typeof index==='number') { currentIndex = Math.max(0, Math.min(characters.length-1,index)); render(); } },
  next(){ navigate('left'); },
  prev(){ navigate('right'); },
  measure(){ // return bounding rect info so host can size itself
    const stage = document.querySelector('.stage');
    if(!stage) return null;
    const r = stage.getBoundingClientRect();
    return { width: Math.ceil(r.width), height: Math.ceil(r.height), left: Math.ceil(r.left), top: Math.ceil(r.top) };
  }
};
</script>
</body>
</html>
